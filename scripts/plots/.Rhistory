plot=misincorp_figure,
path = "/Users/abc6435/Desktop/KROH/figures",
width = 6,
height = 6,
units = "in",
dpi = 300)
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(readr)
library(tidyr)
library(dplyr)
library(reshape2)
library(ggpubr)
setwd("/Users/abc6435/Desktop/KROH/data/mapdamage/")
dnacomp <- read_tsv("dnacomp.txt", comment = "#")
#Calculate Proportions
dnacomp$pA <- dnacomp$A/dnacomp$Total
dnacomp$pC <- dnacomp$C/dnacomp$Total
dnacomp$pG <- dnacomp$G/dnacomp$Total
dnacomp$pT <- dnacomp$T/dnacomp$Total
#Subset Dataframe
prop <- as.data.frame(cbind(dnacomp$Sample, dnacomp$Library,
dnacomp$End, dnacomp$Pos,
dnacomp$pA, dnacomp$pC,
dnacomp$pG, dnacomp$pT))
colnames(prop) <- c("sample", "library", "end",
"pos", "A", "C","G", "T")
#Melt Dataframe and Factor
prop_m <- melt(prop,id.vars=c("sample","library", "end","pos"),
variable.name="nucelotide",
value.name="proportion")
prop_m$end <- factor(prop_m$end, levels = c("5p","3p"))
prop_m$proportion <- as.numeric(prop_m$proportion)
prop_m$pos <- as.numeric(prop_m$pos)
#Contemporary
prop_m_c <- subset(prop_m, prop_m$library=="contemporary")
prop_m_c_plot <-
ggplot(prop_m_c, aes(x = pos, y = proportion, color = nucelotide)) +
geom_line(linewidth = 1) +
facet_grid(rows=vars(sample), cols=vars(end), scale="free") +
scale_y_continuous(limits = c(0,0.7), expand = c(0,0)) +
scale_x_continuous(expand = c(0,0)) +
scale_color_manual(values=
c("#FFBF00","#FF7F50",
"#40E0D0","#6495ED")) +
theme(panel.background = element_blank(),
panel.border = element_blank(),
strip.background = element_rect(fill="gray", color="gray"),
strip.text=element_text(color="black", face="bold", size=8),
panel.spacing.x = unit(15, "points"),
axis.text = element_text(size=8, color="black"),
axis.title = element_text(size=8, color="black")) +
xlab("Distance from read end (bp)") +
ylab("Proportion") +
geom_rect(data = subset(prop_m_c, end == "5p"),
aes(xmin = 0, xmax = 19.9, ymin = 0.05, ymax = 0.6),
color = "black", fill=NA) +
geom_rect(data = subset(prop_m_c, end == "3p"),
aes(xmin = -19.9, xmax = 0, ymin = 0.05, ymax = 0.6),
color = "black", fill=NA)+
geom_hline(yintercept = 0, color="black", linewidth=0.5) +
geom_vline(data = subset(prop_m_c, end == "5p"),
aes(xintercept = -9.7) , color="black", linewidth=0.5)
#Historical
prop_m_h <- subset(prop_m, prop_m$library=="historical")
prop_m_h_plot <-
ggplot(prop_m_h, aes(x = pos, y = proportion, color = nucelotide)) +
geom_line(linewidth = 1) +
facet_grid(rows=vars(sample), cols=vars(end), scale="free") +
scale_y_continuous(limits = c(0,0.7), expand = c(0,0)) +
scale_x_continuous(expand = c(0,0)) +
scale_color_manual(values=
c("#FFBF00","#FF7F50",
"#40E0D0","#6495ED")) +
theme(panel.background = element_blank(),
panel.border = element_blank(),
strip.background = element_rect(fill="black", color="black"),
strip.text=element_text(color="white", face="bold", size=8),
panel.spacing.x = unit(15, "points"),
axis.text = element_text(size=8, color="black"),
axis.title = element_text(size=8, color="black")) +
xlab("Distance from read end (bp)") +
ylab("Proportion") +
geom_rect(data = subset(prop_m_h, end == "5p"),
aes(xmin = 0, xmax = 19.9, ymin = 0.05, ymax = 0.6),
color = "black", fill=NA) +
geom_rect(data = subset(prop_m_h, end == "3p"),
aes(xmin = -19.9, xmax = 0, ymin = 0.05, ymax = 0.6),
color = "black", fill=NA) +
geom_hline(yintercept = 0, color="black", linewidth=0.5) +
geom_vline(data = subset(prop_m_h, end == "5p"),
aes(xintercept = -9.7) , color="black", linewidth=0.5)
dnacomp_plot <- ggarrange(prop_m_h_plot, prop_m_c_plot,
labels = c("A","B"),
common.legend = TRUE,
ncol=2,
nrow=1)
ggsave("dnacomp.png",
plot=dnacomp_plot,
path = "/Users/abc6435/Desktop/KROH/figures",
width = 6,
height = 6,
units = "in",
dpi = 300)
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(readr)
library(tidyr)
library(dplyr)
library(reshape2)
library(ggpubr)
setwd("/Users/abc6435/Desktop/KROH/data/mapdamage/")
dnacomp <- read_tsv("dnacomp.txt", comment = "#")
#Calculate Proportions
dnacomp$pA <- dnacomp$A/dnacomp$Total
dnacomp$pC <- dnacomp$C/dnacomp$Total
dnacomp$pG <- dnacomp$G/dnacomp$Total
dnacomp$pT <- dnacomp$T/dnacomp$Total
#Subset Dataframe
prop <- as.data.frame(cbind(dnacomp$Sample, dnacomp$Library,
dnacomp$End, dnacomp$Pos,
dnacomp$pA, dnacomp$pC,
dnacomp$pG, dnacomp$pT))
colnames(prop) <- c("sample", "library", "end",
"pos", "A", "C","G", "T")
#Melt Dataframe and Factor
prop_m <- melt(prop,id.vars=c("sample","library", "end","pos"),
variable.name="nucelotide",
value.name="proportion")
prop_m$end <- factor(prop_m$end, levels = c("5p","3p"))
prop_m$proportion <- as.numeric(prop_m$proportion)
prop_m$pos <- as.numeric(prop_m$pos)
ggplot(prop_m_c, aes(x = pos, y = proportion, color = nucelotide)) +
geom_line(linewidth = 1) +
facet_grid(rows=vars(sample), cols=vars(end), scale="free") +
scale_y_continuous(limits = c(0,0.7), expand = c(0,0)) +
scale_x_continuous(expand = c(0,0)) +
scale_color_manual(values=
c("#FFBF00","#FF7F50",
"#40E0D0","#6495ED")) +
theme(panel.background = element_blank(),
panel.border = element_blank(),
strip.background = element_rect(fill="gray", color="gray"),
strip.text=element_text(color="black", face="bold", size=8),
panel.spacing.x = unit(15, "points"),
legend.title = element_blank(),
axis.text = element_text(size=8, color="black"),
axis.title = element_text(size=8, color="black")) +
xlab("Distance from read end (bp)") +
ylab("Proportion") +
geom_rect(data = subset(prop_m_c, end == "5p"),
aes(xmin = 0, xmax = 19.9, ymin = 0.05, ymax = 0.6),
color = "black", fill=NA) +
geom_rect(data = subset(prop_m_c, end == "3p"),
aes(xmin = -19.9, xmax = 0, ymin = 0.05, ymax = 0.6),
color = "black", fill=NA)+
geom_hline(yintercept = 0, color="black", linewidth=0.5) +
geom_vline(data = subset(prop_m_c, end == "5p"),
aes(xintercept = -9.7) , color="black", linewidth=0.5)
#Calculate Proportions
dnacomp$pA <- dnacomp$A/dnacomp$Total
dnacomp$pC <- dnacomp$C/dnacomp$Total
dnacomp$pG <- dnacomp$G/dnacomp$Total
dnacomp$pT <- dnacomp$T/dnacomp$Total
#Subset Dataframe
prop <- as.data.frame(cbind(dnacomp$Sample, dnacomp$Library,
dnacomp$End, dnacomp$Pos,
dnacomp$pA, dnacomp$pC,
dnacomp$pG, dnacomp$pT))
colnames(prop) <- c("sample", "library", "end",
"pos", "A", "C","G", "T")
#Melt Dataframe and Factor
prop_m <- melt(prop,id.vars=c("sample","library", "end","pos"),
variable.name="nucelotide",
value.name="proportion")
prop_m$end <- factor(prop_m$end, levels = c("5p","3p"))
prop_m$proportion <- as.numeric(prop_m$proportion)
prop_m$pos <- as.numeric(prop_m$pos)
#Subset by pop
prop_m_c <- subset(prop_m, prop_m$library=="contemporary")
prop_m_h <- subset(prop_m, prop_m$library=="historical")
ggplot(prop_m_c, aes(x = pos, y = proportion, color = nucelotide)) +
geom_line(linewidth = 1) +
facet_grid(rows=vars(sample), cols=vars(end), scale="free") +
scale_y_continuous(limits = c(0,0.7), expand = c(0,0)) +
scale_x_continuous(expand = c(0,0)) +
scale_color_manual(values=
c("#FFBF00","#FF7F50",
"#40E0D0","#6495ED")) +
theme(panel.background = element_blank(),
panel.border = element_blank(),
strip.background = element_rect(fill="gray", color="gray"),
strip.text=element_text(color="black", face="bold", size=8),
panel.spacing.x = unit(15, "points"),
legend.title = element_blank(),
axis.text = element_text(size=8, color="black"),
axis.title = element_text(size=8, color="black")) +
xlab("Distance from read end (bp)") +
ylab("Proportion") +
geom_rect(data = subset(prop_m_c, end == "5p"),
aes(xmin = 0, xmax = 19.9, ymin = 0.05, ymax = 0.6),
color = "black", fill=NA) +
geom_rect(data = subset(prop_m_c, end == "3p"),
aes(xmin = -19.9, xmax = 0, ymin = 0.05, ymax = 0.6),
color = "black", fill=NA)+
geom_hline(yintercept = 0, color="black", linewidth=0.5) +
geom_vline(data = subset(prop_m_c, end == "5p"),
aes(xintercept = -9.7) , color="black", linewidth=0.5)
#Contemporary
prop_m_c_plot <-
ggplot(prop_m_c, aes(x = pos, y = proportion, color = nucelotide)) +
geom_line(linewidth = 1) +
facet_grid(rows=vars(sample), cols=vars(end), scale="free") +
scale_y_continuous(limits = c(0,0.7), expand = c(0,0)) +
scale_x_continuous(expand = c(0,0)) +
scale_color_manual(values=
c("#FFBF00","#FF7F50",
"#40E0D0","#6495ED")) +
theme(panel.background = element_blank(),
panel.border = element_blank(),
strip.background = element_rect(fill="gray", color="gray"),
strip.text=element_text(color="black", face="bold", size=8),
panel.spacing.x = unit(15, "points"),
legend.title = element_blank(),
axis.text = element_text(size=8, color="black"),
axis.title = element_text(size=8, color="black")) +
xlab("Distance from read end (bp)") +
ylab("Proportion") +
geom_rect(data = subset(prop_m_c, end == "5p"),
aes(xmin = 0, xmax = 19.9, ymin = 0.05, ymax = 0.6),
color = "black", fill=NA) +
geom_rect(data = subset(prop_m_c, end == "3p"),
aes(xmin = -19.9, xmax = 0, ymin = 0.05, ymax = 0.6),
color = "black", fill=NA)+
geom_hline(yintercept = 0, color="black", linewidth=0.5) +
geom_vline(data = subset(prop_m_c, end == "5p"),
aes(xintercept = -9.7) , color="black", linewidth=0.5)
#Historical
prop_m_h_plot <-
ggplot(prop_m_h, aes(x = pos, y = proportion, color = nucelotide)) +
geom_line(linewidth = 1) +
facet_grid(rows=vars(sample), cols=vars(end), scale="free") +
scale_y_continuous(limits = c(0,0.7), expand = c(0,0)) +
scale_x_continuous(expand = c(0,0)) +
scale_color_manual(values=
c("#FFBF00","#FF7F50",
"#40E0D0","#6495ED")) +
theme(panel.background = element_blank(),
panel.border = element_blank(),
strip.background = element_rect(fill="black", color="black"),
strip.text=element_text(color="white", face="bold", size=8),
panel.spacing.x = unit(15, "points"),
legend.title = element_blank(),
axis.text = element_text(size=8, color="black"),
axis.title = element_text(size=8, color="black")) +
xlab("Distance from read end (bp)") +
ylab("Proportion") +
geom_rect(data = subset(prop_m_h, end == "5p"),
aes(xmin = 0, xmax = 19.9, ymin = 0.05, ymax = 0.6),
color = "black", fill=NA) +
geom_rect(data = subset(prop_m_h, end == "3p"),
aes(xmin = -19.9, xmax = 0, ymin = 0.05, ymax = 0.6),
color = "black", fill=NA) +
geom_hline(yintercept = 0, color="black", linewidth=0.5) +
geom_vline(data = subset(prop_m_h, end == "5p"),
aes(xintercept = -9.7) , color="black", linewidth=0.5)
dnacomp_plot <- ggarrange(prop_m_h_plot, prop_m_c_plot,
labels = c("A","B"),
common.legend = TRUE,
ncol=2,
nrow=1)
ggsave("dnacomp.png",
plot=dnacomp_plot,
path = "/Users/abc6435/Desktop/KROH/figures",
width = 6,
height = 6,
units = "in",
dpi = 300)
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(tidyverse)
library(dplyr)
library(ggpubr)
setwd("~/Desktop/KROH/data/rohan")
#ROHan Coverage
cov <- read.table("rohan_cov.txt", header=FALSE)
colnames(cov) <- c("sample", "cov")
cov$cov <- round(cov$cov,2)
cov$cov <- paste0(cov$cov, "x")
#Segments in ROH (%)
roh <- read.table("percent_ROH.txt", header=TRUE)
colnames(roh) <- c("sample", "fROH", "CI")
roh$sample <- as.character(roh$sample)
roh$pop <- c(rep("ckIWA",7), rep("hKIWA",6))
roh$CI <- gsub("[()]", "", roh$CI)
roh <- separate(data=roh, col="CI", into = c("min_CI","max_CI"), sep = ",")
roh$min_CI <- as.numeric(roh$min_CI)
roh$max_CI <- as.numeric(roh$max_CI)
# Genome-wide theta outside ROH
theta_o_roh <- read.table("gw_theta_outside_ROH.txt", header=TRUE)
# Genome-wide theta including ROH
theta_inc_roh <- read.table("gw_theta_inc_ROH.txt", header=TRUE)
colnames(theta_inc_roh) <- c("sample","mid","min","max")
#Merge Data
tmp1 <- merge(cov,roh,by="sample")
tmp2 <- merge(theta_o_roh, theta_inc_roh, by="sample")
roh_theta <- merge(tmp1, tmp2, by="sample")
roh_theta$sample <- factor(roh_theta$sample,
levels = c("183195332","183195312","183194841",
"183195321","183194861","183195304",
"183195326","507264","29779",
"383194", "383202","383205","507265"))
#nroh_sroh
nroh_sroh <- read.csv("nroh_sroh.txt", header=TRUE, fill = TRUE)
nroh_sroh[is.na(nroh_sroh)] <- 0
nroh_sroh$pop <- c(rep("ckIWA",21), rep("hKIWA",18))
nroh_sroh$hmm_posterior_decoding <- factor(nroh_sroh$hmm_posterior_decoding,
levels = c("min","mid","max"))
#Heterozygosity
h <- read.table("het.txt", header=TRUE)
ggplot(roh_theta, aes(x=sample, y=fROH, fill=pop)) +
geom_bar(stat="identity") +
geom_errorbar(aes(ymin=min_CI, ymax=max_CI),
color="black",
width=0.1) +
geom_text(aes(label = cov), y=-1, size=2) +
geom_point(aes(y = thetamid * 5000),
color = "#0099FF",
size = 2,
alpha=1.0,
show.legend = FALSE) +
geom_point(aes(y = mid * 5000),
color = "#FF6600",
size = 2,
alpha=0.8,
show.legend = FALSE) +
geom_errorbar(aes(y=thetamid*5000, ymin=thetamin*5000, ymax=thetamax*5000),
color = "#0099FF",
width = 0.3,
alpha=1.0) +
geom_errorbar(aes(y=mid*5000, ymin=min*5000, ymax=max*5000),
color = "#FF6600",
width = 0.3,
alpha=0.8) +
scale_fill_manual(values=c("gray","black")) +
scale_y_continuous(name="ROH (%)", expand=c(0,2), limits=c(0,30),
sec.axis=sec_axis(~./5000,name=expression("Genomewide "*theta))) +
labs(x = NULL) +
theme(
panel.background = element_blank(),
panel.grid = element_blank(),
panel.border = element_rect(color = "black", fill = NA),
legend.background = element_blank(),
legend.title = element_blank(),
legend.position = c(0.9,0.90),
axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5),
axis.text = element_text(color="black", size=8),
text = element_text(size = 8))
ggplot(nroh_sroh, aes(x = sroh/1e6, y = nroh, color = pop)) +
geom_point(size = 1, alpha=0.5) +
scale_color_manual(values = c("gray", "black")) +
facet_wrap(~hmm_posterior_decoding, ncol = 3) +
xlab("SROH (Mb)") +
ylab("NROH") +
theme(
panel.background = element_blank(),
panel.grid = element_blank(),
panel.border = element_rect(color = "black", fill = NA),
legend.background = element_blank(),
legend.title = element_blank(),
legend.position = "none",
strip.text = element_text(color="white"),
strip.background = element_rect(fill="black", color=NA),
axis.text = element_text(color="black", size=8),
text = element_text(size = 8))
ggplot(h, aes(x = end, y = h, color=pop)) +
geom_line() +
scale_y_continuous(expand = c(0,0)) +
scale_color_manual(values=c("gray","black")) +
facet_grid(. ~ chrom, scales = "free_x", space = "free_x", switch="x") +
ylab("Heterozygosity") +
theme(axis.line = element_line(color="black"),
axis.ticks = element_blank(),
#axis.text.y = element_text(size=8, color="blue"),
axis.title.x = element_blank(),
axis.text.x = element_blank(),
strip.text.x = element_text(angle=90, vjust = 0.5, size=8, color="black"),
strip.placement = "outside",
strip.background = element_blank(),
panel.background = element_blank(),
panel.border = element_blank(),
panel.spacing = unit(0.0, 'points'),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
legend.title = element_blank(),
legend.background = element_blank(),
legend.key = element_rect(fill = "white", color = NA),
axis.text = element_text(color="black", size=8),
text = element_text(size = 8))
h$chrom <- factor(h$chrom, levels = unique(h$chrom))
ggplot(h, aes(x = end, y = h, color=pop)) +
geom_line() +
scale_y_continuous(expand = c(0,0)) +
scale_color_manual(values=c("gray","black")) +
facet_grid(. ~ chrom, scales = "free_x", space = "free_x", switch="x") +
ylab("Heterozygosity") +
theme(axis.line = element_line(color="black"),
axis.ticks = element_blank(),
#axis.text.y = element_text(size=8, color="blue"),
axis.title.x = element_blank(),
axis.text.x = element_blank(),
strip.text.x = element_text(angle=90, vjust = 0.5, size=8, color="black"),
strip.placement = "outside",
strip.background = element_blank(),
panel.background = element_blank(),
panel.border = element_blank(),
panel.spacing = unit(0.0, 'points'),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
legend.title = element_blank(),
legend.background = element_blank(),
legend.key = element_rect(fill = "white", color = NA),
axis.text = element_text(color="black", size=8),
text = element_text(size = 8))
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(ggpubr)
library(tidyr)
library(dplyr)
library(reshape2)
setwd("~/Desktop/KROH/data/rab")
df <- read.table("results.txt", header = TRUE)
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(ggpubr)
library(tidyr)
library(dplyr)
library(reshape2)
setwd("~/Desktop/KROH/data/rab")
df <- read.table("results.txt", header = TRUE)
df
rab <- rbind(
subset(df, df$MUT=="lossoffunction"),
subset(df, df$MUT=="deleterious"),
subset(df, df$MUT=="nonsynonymous"),
subset(df, df$MUT=="tolerated"),
subset(df, df$MUT=="synonymous"),
subset(df, df$MUT=="noncoding"))
rownames(rab) <- NULL
rab$NUM <- c(1,2,4,5,7,8,10,11,13,14,16,17)
rab
rab_plot <-
ggplot(rab, aes(y=NUM, fill=MUT, alpha=NEUTRAL)) +
geom_rect(aes(xmin=1, xmax=RAB, ymin=NUM-0.4, ymax=NUM+0.4),
color="black") +
scale_alpha_manual(values=c(1,0.5), name=NULL) +
scale_fill_manual(values = colors2, guide="none") +
geom_errorbarh(aes(xmin = Q25, xmax = Q97, y = NUM), height = 0.2) +
scale_x_continuous(limits=c(0,1.5), breaks=seq(0,1.5,0.2)) +
scale_y_continuous(
breaks = c(1.5,4.5,7.5,10.5,13.5,16.5),
labels = unique(rab$MUT)) +
geom_vline(xintercept = 1.0, color="black") +
theme(
panel.background = element_blank(),
panel.grid.minor.x = element_line(linetype="dashed", color="black", linewidth=.05),
panel.border = element_rect(color="black", fill=NA),
axis.title.y = element_blank(),
axis.text.x = element_text(size=8, color="black"),
axis.text.y = element_text(size=8, color="black"),
legend.position = "bottom") +
xlab("RAB")
colors1 = c(
"lossoffunction"="#FF12B4",
"deleterious"="#C870E0",
"nonsynonymous"="#7083E0",
"tolerated"="#70E0CA",
"synonymous"="#C1E070",
"noncoding"="#FFD400"
)
colors2 = c(
"lossoffunction"="#750B54",
"deleterious"="#6B3D78",
"nonsynonymous"="#3D4778",
"tolerated"="#3D8072",
"synonymous"="#4F5C2F",
"noncoding"="#8F7703"
)
rab_plot <-
ggplot(rab, aes(y=NUM, fill=MUT, alpha=NEUTRAL)) +
geom_rect(aes(xmin=1, xmax=RAB, ymin=NUM-0.4, ymax=NUM+0.4),
color="black") +
scale_alpha_manual(values=c(1,0.5), name=NULL) +
scale_fill_manual(values = colors2, guide="none") +
geom_errorbarh(aes(xmin = Q25, xmax = Q97, y = NUM), height = 0.2) +
scale_x_continuous(limits=c(0,1.5), breaks=seq(0,1.5,0.2)) +
scale_y_continuous(
breaks = c(1.5,4.5,7.5,10.5,13.5,16.5),
labels = unique(rab$MUT)) +
geom_vline(xintercept = 1.0, color="black") +
theme(
panel.background = element_blank(),
panel.grid.minor.x = element_line(linetype="dashed", color="black", linewidth=.05),
panel.border = element_rect(color="black", fill=NA),
axis.title.y = element_blank(),
axis.text.x = element_text(size=8, color="black"),
axis.text.y = element_text(size=8, color="black"),
legend.position = "bottom") +
xlab("RAB")
ggsave("rab_tv_ts_plot.png", plot=rab_plot,
path ="~/Desktop/KROH/figures",
width = 4, height = 4.5, units = "in", dpi = 300)
