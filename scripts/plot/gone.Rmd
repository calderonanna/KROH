---
title: "gone"
author: "Anna Maria Calderon"
date: "2025-02-18"
output: html_document
---

```{r setup, include=FALSE}
library(ggplot2)
library(dplyr)
library(tidyr)
library(reshape2)
library(knitr)
```

## Download Data

```{bash}
#Download Files to local
rsync abc6435@submit.hpc.psu.edu:/storage/home/abc6435/SzpiechLab/abc6435/KROH/data/gone/Ne/* /Users/annamariacalderon/Desktop/KROH/data/gone
```

## Import Data

```{r import_data, include=FALSE}
setwd("/Users/annamariacalderon/Desktop/KROH/data/gone")

ne_files <- list.files(pattern="Output_Ne_*")
ne_list <- list()
for (i in 1:70) {
  ne_list[[i]] <- read.table(ne_files[i], header=TRUE)
}

```

## Modify Data

```{r modify_data}
#Subset the frist 120 generations and bind datasets
for (i in 1:70) {
  ne_list[[i]] <- ne_list[[i]][1:120, 2]
}

Ne <- do.call(cbind, ne_list)
Ne <- as.data.frame(as.numeric(Ne))
Ne$Generation <- nrow(Ne)

#Renmae Columns
colnames(Ne) <- c("Generation", "R1", "R2", "R3", "R4", "R5", "R6",
                  "R7", "R8", "R9", "R10")

#Melt df
Ne_m <- melt(Ne, id.vars = "Generation", value.name = "Geom_mean_Ne", variable.name = "rep")
```

# Ne Distributions by Generation

```{r}

ggplot(subset(Ne_m, Generation %in% 120), aes(x = Geom_mean_Ne)) +
  geom_histogram(alpha = 0.5, position = "identity", fill="blue") +
  labs(x = "Ne Estimate", y = "Frequency", 
       title = "Distribution of Ne Estimates 120",
       fill = "Generation") +
  theme_minimal()
```

## Calculate Confidence Intervals

```{r}
#Calculate Mean Ne across reps
n <- 10
df <- n-1
a <- 0.05
mean <- rowMeans(Ne)
se <- (apply(Ne[, -1], 1, sd))/sqrt(10)
t_score <- print(qt(p=a/2, df=df, lower.tail=F))
margin_err <- (t_score * se)
lower <- (mean - margin_err)
upper <- (mean + margin_err)

Ne_CI <- cbind(mean, lower, upper)
```

## Plot Ne Estimates

```{r plot, echo=FALSE}
#Full Dataset
ggplot(Ne_m, aes(x=Generation, y=Geom_mean_Ne, alpha=rep)) + 
  geom_line() +
  scale_alpha_discrete(range=c(0.3, 0.3)) +
  scale_x_continuous(breaks=seq(0, 120, 5))  +
  xlab("Generation") +
  ylab("Geometric Mean Ne") +
  ggtitle("") +
  theme(panel.background = element_blank(),
        legend.position="none",
        panel.border = element_rect(color = "black", fill = NA))
```
